<html>
  <head>
    <meta charset="utf-8">
    <title>Заметки Романа Теличкина</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/index.css">
  </head>
  <body>
    <div class="header">
      <a href="/">Заметки Романа Теличкина</a>
    </div>
    <div class="main">
      <h1>Интеграционные или модульные тесты?</h1><pre class="small">Май 2018</pre><div>Когда читаешь книги Роберта Мартина про <a href="https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">чистый код</a> или про <a href="https://www.amazon.com/Clean-Coder-Conduct-Professional-Programmers/dp/0137081073">хороших программистов</a>, сразу хочется покрыть весь свой код модульными тестами, встать на путь TDD и никогда с него не сходить. Выступления про <a href="https://www.youtube.com/watch?v=VDfX44fZoMc">вред интеграционных тестов</a> еще больше укрепляют уверенность в необходимости модульных тестов. Утверждения в книгах и выступлениях кажутся верными, но применение новых практик в ежедневной работе вызывает боль.&nbsp;</div><div>Основные боли с которыми мне приходилось сталкиваться при работе с модульными тестами:</div><div><ul><li>рефакторинг, который сложнее чем переименование переменной, точно ломает какие-то тесты</li><li>желание разработчиков сделать тесты модульными рождает много моков, которые приводят как к поломке тестов при рефакторинге, так и к ложно-положительным результатам тестов</li><li>они не помогают разобраться в работе той или иной функциональности</li></ul></div><div>Можно терпеть боль и продолжать применять практики. Можно поддерживать запал, смотря на <a href="https://martinfowler.com/bliki/TestPyramid.html">пирамиду тестирования</a> и повторяя "модульные тесты – основа пирамиды, их должно быть больше всего", – это снизит боль, но не устранит её причину.</div><div>Разобраться в причине боли мне помогли книги и статьи Кента Бека – человека, который придумал <a href="https://www.amazon.com/Extreme-Programming-Explained-Embrace-Change/dp/0321278658">Extreme Programming</a> и <a href="https://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530">Test Driven Development</a>. Если Роберт Мартин говорит с читателем языком догм: "Настоящий программист должен писать по TDD и точка!", то Кент Бек ведет диалог с читателем и описывает те ценности и принципы, которые привели его к конкретным практикам, в данном случае к TDD.&nbsp;</div><div>Основные принципы из которых появился TDD: продукт должен быть качественным, шаги для решения проблемы должны быть маленькими, процесс разработки должен идти потоком (flow). Именно из-за принципа маленьких шагов TDD ассоциируется с модульными тестами. Причем Кент не говорит таких догм как "тесты не должны ходить в базу данных" или "при тестировании одного объекта все его зависимости должны быть подменены".&nbsp;</div><div>Тесты должны давать вам уверенность в работоспособности продукта и возможность придумывать решение ваших проблем шаг за шагом, не сбивая ваш фокус. Все, больше ничего. Конкретные же практики зависят от конкретной ситуации.&nbsp;</div><div>Если при тестировании можно использовать in-memory базу данных и прогонять сотни тестов за доли секунды – используйте её! Ведь это увеличит уверенность в работоспособности продукта. Если вы не знаете конкретный путь к реализации функциональности, то сделайте первый шаг – напишите самый высокоуровневый тест в тех терминах, в которых вы сейчас понимаете задачу. И если этого теста будет достаточно для реализации функциональности без потери уверенности в ней, то смело его оставляйте.&nbsp;</div><div>Но если вам сложно понимать настройку ваших тестов, и это бьёт по уверенности в работоспособности продукта, то стоит их упростить. Например, перенеся большую часть проверок на уровнь ниже – в более модульные тесты, или создав абстракцию для настройки тестов. Если ваши тесты идут слишком долго и прерывают поток разработки, то можно их ускорить. Причем ускорять можно несколькими способами, например перестать ходить в базу данных или запускать тесты параллельно на нескольких базах. Любой способ хорош, если он не идет вразрез с принципами.&nbsp;</div><div>Не нужно бояться интеграционных тестов, если вам комфортно работать с ними. Если вам комфортно работать с вашими модульными тестами – продолжайте с ними работать. Главное – перестать слепо следовать догмам, прислушиваться к своим ощущениям и рефлексировать, стараясь взглянуть на проблему с нескольких точек зрения.</div>
    </div>
    <div class="comments">
      <div class="open-comments opened" onclick="toggleComments(this)">Открыть комментарии</div>
      <div id="disqus_thread"></div>
    </div>
    <script src="/toggle-comments.js"></script>
  </body>
</html>